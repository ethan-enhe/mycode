# 一棵树

## 题意

![题意](https://pic.imgdb.cn/item/6281d8910947543129029d73.jpg)

## 题解

$k=0$ 不难，略。

一个显然的想法是枚举断掉的边，然后看每条边的贡献。

贡献分为两类，一类是新加的边的块间贡献:

![](https://pic.imgdb.cn/item/6281dac60947543129099dfa.jpg)

这个不难算，另外一类是原先的边的块内贡献。

![](https://pic.imgdb.cn/item/6281daf809475431290a5279.jpg)

不妨设虚线边断开，实线边把一个连通块分为大小为 $a,b$ 的两块，则这条实线边的贡献是上面的式子。

于是在枚举了虚线边之后，分子树内，祖先，既非子树也非祖先三种情况讨论，不妨设 a 是虚线边较深的端点，b 是实线边较深的端点：

![](https://pic.imgdb.cn/item/6281db9809475431290c57a7.jpg)

可以发现，三个贡献的式子后两项都只和 a 有关，前两项都可以展开成和 b 有关的二次多项式，因此只需要维护下子树内，祖先上的 sz 的和，sz 的平方之和即可快速计算。
